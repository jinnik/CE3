\documentclass{article}
\usepackage{amsmath}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
% \pgfplotsset{compat=1.14}
\usepgfplotslibrary{groupplots}
\usetikzlibrary{spy}
% \usetikzlibrary{external} % Probaby doesn't work on overleaf :(
\usepackage{listings}
\usepackage{siunitx}
\usepackage{cleveref}
\usepackage{booktabs}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\lstset{language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}

\pgfplotsset{/pgfplots/table/tableformat/.style={
  col sep=semicolon,  % the separator in our .csv file
  every head row/.style={before row=\toprule,after row=\midrule},
  every last row/.style={after row=\bottomrule},
  every column/.append style={numeric type, dec sep align},
  },
}

\def\d{\mathrm{d}}
% \tikzexternalize

\date{2018-09-14}
\author{Jing Ying Ko jyko@kth.se 
\and Henrik Grimler hgrimler@kth.se}
\title{Computer exercise 3 in SF2520 \\Partial differential equation of parabolic type \\CE3 37 }
\begin{document}

\maketitle
\section{Rescaling to dimensionless form}

The following partial differential equation is given:
\begin{equation} \label{eq1}
\rho c_p \frac{\partial T}{\partial t} = \kappa \frac{\partial^2 T}{\partial x^2}
\end{equation}
with boundary conditions
\begin{equation} \label{eq1}
   T(0,t)= 
\begin{cases}
    T_0,           & 0 \leq t \leq t_P, \\
    0,              & t > t_P,
\end{cases}
   \hspace{0.8cm}         \frac{\partial T}{\partial x}(L,t)=0,
\end{equation}
and initial conditions
\begin{equation} \label{eq1}
   T(x,0)= 
\begin{cases}
    T_0,           & x=0, \\
    0,              & 0 < x \leq L
\end{cases}
\end{equation}
where $\rho$ is the density [\si{\kilo\gram\per\meter\cubed}], $c_p$ is the heat capacity [\si{\joule\per\kilo\gram\per\kelvin}] and $\kappa$ is the thermal conductivity [\si{\joule\per\meter\per\second\per\kelvin}] of the rod.
\newline

\noindent
1. Introduce reference values ($T_0$,$L$,$t_P$) for each of the three variables ($T,x,t$) and define the corresponding dimensionless variables
\begin{equation}
    T = T_0 u, \hspace{0.8cm} x = L \xi, \hspace{0.8cm} t = t_P \tau.
\end{equation}

\noindent
2. Rewrite differential equations in those variables
\begin{equation*}
\begin{split}
    \frac{\partial T}{\partial t} &= \frac{T_0}{t_P} \frac{\partial u}{\partial \tau} \\
    \frac{\partial}{\partial x} &= \frac{1}{L} \frac{\partial}{\partial \xi} \\
    \frac{\partial^2 T}{\partial x^2} &= \frac{T_0}{L^2} \frac{\partial^2 u}{\partial \xi^2}
\end{split}
\end{equation*}
Rewrite Equation~\ref{eq1} into
\begin{equation*}
\begin{split}
    \rho c_p \frac{\partial u}{\partial \tau} &= \kappa \frac{T_0}{L^2} \frac{\partial^2 u}{\partial \xi^2} \\
    \frac{\partial u}{\partial \tau} &= \frac{\kappa t_p}{\rho c_p L^2} \frac{\partial^2 u}{\partial \xi^2}
\end{split}
\end{equation*}
and therefore can be transformed into the following dimensionless form
\begin{equation*}
    \frac{\partial u}{\partial \tau} = a \frac{\partial^2 u}{\partial \xi^2}, \hspace{0.8cm} \tau > 0, \hspace{0.8cm} 0 < \xi < \frac{L}{L}=1
\end{equation*}
with boundary conditions
\begin{equation*} 
   u(0,\tau)= 
\begin{cases}
    \frac{T_0}{T_0} = 1,           & 0 \leq \tau \leq \frac{t_P}{t_P}, \\
    0,              & \tau > 1,
\end{cases}
   \hspace{0.8cm}         \frac{\partial u}{\partial \xi}(1,\tau) = 0,
\end{equation*}
and initial conditions
\begin{equation*} 
   u(\xi,0) = 
\begin{cases}
    \frac{T_0}{T_0} = 1,           & \xi = 0, \\
    0,              & 0 < \xi \leq \frac{L}{L}=1
\end{cases}
\end{equation*}
with expression $a$ as
\begin{equation*}
\begin{split}
    a &= \frac{\kappa t_P}{\rho c_p L^2} \\
    [a] &= \si{\joule\per\meter\per\second\per\kelvin\second\meter\cubed\per\kilo\gram\kilo\gram\kelvin\per\joule}%\frac{J}{m \cdot s \cdot C} \cdot s \cdot \frac{m^3}{kg} \frac{kg \cdot C}{J} \frac{1}{m^2} 
    = 1
\end{split}
\end{equation*}
and assuming $a$ has a numerical value of 1.

\section{Discretization}

The semidiscretization approach is used. Using constant stepsize $h$ and space discretization into $n$ space:
\begin{equation*}
    \xi_i = i \cdot h \hspace{0.8cm} \text{where}  \hspace{0.8cm} 1 \leq i \leq n 
\end{equation*}
We approximate
\begin{equation*}
    u_i(t) \approx u(\xi_i,t)
\end{equation*}
and discretize $u_{\xi \xi}$ with approximation of order 2
\begin{equation*}
    u_{\xi \xi}(t,\xi_i) \approx \frac{u_{i-1}(t) - 2u_i(t) + u_{i+1}(t)}{h^2} + 0(h^2) \hspace{0.8cm} i = 1, ..., n
\end{equation*}
and so
\begin{equation*}
    \frac{d u_i}{d\tau} = \frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}  \hspace{0.8cm} i = 2, ..., n-1
\end{equation*}
As for the boundary conditions at $i = 1$
\begin{equation*}
    \frac{d u_1}{d\tau} = \frac{\alpha(\tau) - 2u_1 + u_{2}}{h^2}  \hspace{0.8cm} i = 1
\end{equation*}
where 
\begin{equation*} 
  \alpha(\tau)= 
\begin{cases}
    1,           & 0 \leq \tau \leq 1, \\
    0,              & \tau > 1,
\end{cases}
\end{equation*}
and at $i = n$, a ghost point is used, and so
\begin{equation*}
    \frac{d u_n}{d\tau} = \frac{u_{n-1} - 2u_n + u_{n+1}}{h^2}  \hspace{0.8cm} i = n
\end{equation*}
Given the Newman boundary condition
\begin{equation*}
    \frac{\partial u}{\partial \xi} (1,\tau) = 0
\end{equation*}
which can be discretized in the form
\begin{equation*}
\begin{split}
        \frac{\partial u}{\partial \xi} (1,\tau) &= \frac{u(1+h,\tau)-u(1-h,\tau)}{2h} + 0(h^2)\\
         \frac{\partial u}{\partial \xi} (1,\tau) &= \frac{u_{n+1}-u_{n-1}}{2h} + 0(h^2)
\end{split}
\end{equation*}
and so
\begin{equation*}
\begin{split}
    \frac{u_{n+1}-u_{n-1}}{2h} &= 0 \\
    u_{n+1} &= u_{n-1}
\end{split}
\end{equation*}
resulting in
\begin{equation*}
    \frac{d u_n}{d\tau} = \frac{2u_{n-1} - 2u_n}{h^2}  \hspace{0.8cm} i = n
\end{equation*}

\noindent
Therefore, the equations that we need are
\begin{equation*}
\begin{split}
    \frac{d u_1}{d\tau} &= \frac{\alpha(\tau) - 2u_1 + u_{2}}{h^2}  \hspace{0.8cm} i = 1 \\
    \frac{d u_i}{d\tau} &= \frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}  \hspace{0.8cm} i = 2, ..., n-1    \\
    \frac{d u_n}{d\tau} &= \frac{2u_{n-1} - 2u_n}{h^2}  \hspace{0.8cm} i = n
\end{split}
\end{equation*}
These can be written in the form
\begin{equation*}
    \frac{d u}{d \tau} = Au + b(\tau), \hspace{0.8cm} u(0) = u_0
\end{equation*}
where A is a $ n x n$ matrix, u is a $n x 1$ vector, b($\tau$) is a $n x 1$ vector and $u_0$ is a $n x 1$ vector:
\begin{equation*}
    A = \frac{1}{h^2} 
\begin{bmatrix}
    -2 & 1 & \dots  \\
    1 & -2 & 1 & \dots \\
    \vdots & \vdots & \ddots \\
    \vdots & \vdots & \vdots & \ddots \\
    \dots & 1 & -2 & 1 \\
    \dots & \dots & 2 & -2
\end{bmatrix}
\end{equation*}

\end{document}
